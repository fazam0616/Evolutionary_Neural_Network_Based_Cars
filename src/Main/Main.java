package Main;

import Car.Car;
import Car.Map;

import javax.imageio.ImageIO;
import java.awt.*;
import java.awt.image.BufferedImage;
import java.io.IOException;
import java.util.LinkedList;
import java.util.Random;

import Car.Point;
import GUI.Window;
import NeuralNetworking.Brain;
import NeuralNetworking.BrainObject;

public class Main {
    public static Map map;
    public static String weights = "<6{11.661071710945823,27.204111449926167,4.734086295120584,-0.755377872027839,-2.836939217785285,-17.690800589846265,18.897793659521355,-22.448400218066492,20.987506552598603,-15.846336923575796,14.688371353145868,0.287181540257472,-23.009050698065636,}{1.5495663243099997,4.342697994443896,-2.435985334479315,-3.6817483179070405,-24.2673518988016,-3.8986513167676633,-19.085273256999454,6.151004767230295,-6.433590928762415,6.457647461827436,-16.669848031989027,3.69334169751854,-22.702602369165252,}{2.131629595736362,0.2796085048242256,13.55633593283511,-1.4669410020884985,5.041990569623083,8.121249846917644,8.071407323983033,2.3711483699079503,4.4650680097334305,16.47289249939505,33.4471050398985,-1.8518122120947673,-6.451496501837761,}{-2.426660596833093,0.5281721950174223,2.4456587993570107,5.650998982913084,16.36687033067615,24.566950755682555,5.734043149593413,8.556930947673278,-0.6349921180097491,25.337587107357496,-15.9328554902486,1.0205124477914485,-24.873771043029784,}{27.52740884412348,-38.50245140245107,-3.162227659167165,11.346246441166606,9.933694078356346,8.608997081776756,23.671405473909587,-23.228469880944804,17.66995789355438,-18.84537724496258,22.712225655300713,-14.732938711311194,-27.16683754185053,}{-6.989644307357214,5.654147464719426,2.9378796879341755,13.863869712182137,-4.891463082354415,-6.84578650229341,-9.486801509468119,-43.84302064662679,-0.3535756697128536,7.378666122036565,-18.277599898635962,-10.473393470157355,2.796692637615477,}><2{-11.82091942696974,-13.269418959509409,16.553725908309833,16.434893113625108,-5.491297335958041,-23.759865843583707,}{0.808695704582056,10.954715364881233,-14.497376063685934,-3.851705518362707,-5.288020497758424,-37.713583969965555,}>";

    public static LinkedList<BrainObject> cars = new LinkedList<>();
    public static Car car;
    public static Point respawnPoint = new Point(-5,-157);
    public static double respawnRot = -90;
    public static Window window;
    public static final boolean TEST = false;

    public static void main(String[] args) throws IOException, InterruptedException {
        //System.out.println(respawnPoint.mathToScreen(500,500));
        Random r = new Random();
        BufferedImage mapImage = ImageIO.read(Main.class.getResource("/Main/Maps/map8.bmp"));
        map = new Map(mapImage, respawnPoint);



        if(TEST){
            car = new Car(Color.red,respawnPoint,respawnRot,weights);
            car.isBest = true;
        }else{
            for (int i = 0; i < 5000; i++) {
                cars.add(new Car(
                        new Color(Math.abs(r.nextInt()) % 255, Math.abs(r.nextInt()) % 255, Math.abs(r.nextInt()) % 255),
                        respawnPoint, respawnRot));
            }
            System.out.println("Initializing Brains...");
            Brain.start(cars);
//            Brain.start(cars, new Car(Color.white,Point.O,0,"<3{4.639881972946576,-21.153436331187415,6.230366834245975,-15.448013900829002,0.2172816296081128,-22.943746984701775,1.0390961074065261,-12.765518829137443,-0.5643849809418799,-1.5185483593051887,19.989181536008083,-1.070521711210833,17.57292863361968,4.836945155476693,3.0992729774397376,0.7134042926756863,1.4837382171862863,-16.039254226509396,}{22.84880229473517,-5.329823362251601,-3.4178065732618306,-10.114961198336792,15.118511742213403,-15.937819714092965,13.137884569786966,2.228211746626547,5.53263453205493,2.7926783554479067,-4.75033223001611,0.01661911565646071,9.404674039808434,8.201206227367134,13.162162448389568,3.6789096015448792,-14.658906516230505,-11.173947028504289,}{-28.509221839523242,6.579959918753092,-27.80501313471413,-4.825961135895899,-9.094800734802112,-0.636060210224453,-0.26816371748834916,4.442165807462955,4.5559694696428075,5.61395915321553,2.2196870273774785,-3.8505671946336957,-5.647966100787464,-3.7621997052195986,-6.374863706513891,4.99075053128153,11.64313208899155,-0.5976153403825355,}><3{3.0844454738400846,-5.182433736251179,13.596151654675612,}{-2.005529625408276,-7.571529167053527,-11.298869594363442,}{1.3282706747068764,-15.484759526337504,-25.180375735560546,}><2{-31.330736947875174,-3.7019117010070888,3.684412371753518,}{2.71028263869559,-8.664595527033649,-16.83092674531273,}>").brain);
            System.out.println("Done.");
        }

        window = new Window(map);

        if (TEST){
            while (true) {
//                car.changeRot(-window.dtheta);
//                car.changeSpeed(window.dvel);
//                car.update();
                car.tick();
//                if (map.getVal(car.getCentre()) == 1)
//                    car.reset();
                window.repaint();
                //Thread.sleep(1000 / 60);
            }
        }
    }
}
